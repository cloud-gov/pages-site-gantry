---
import Layout from "@/layouts/Layout.astro";
import Hero from "@/components/Hero.astro";
import CardGrid from "@/components/CardGrid.astro";
import RichText from "@/components/RichText.astro";
import { fetchHomePage } from "@/utilities/fetch";
import TextBlockImageBg from "@/components/TextBlockImageBg.astro";

// Fetch home page data from Payload CMS

const homePageData = await fetchHomePage();
const contentBlocks = homePageData?.content || [];
---

<Layout title="Home Page">
  {
    contentBlocks.map((block: any) => {
      switch (block.blockType) {
        case "hero":
          return (
            <Hero
              title={block.title}
              subtitle={block.subtitle}
              description={block.description}
              bgImage={block.bgImage}
              ctaButton={block.ctaButton}
            />
          );

        case "cardGrid":
          return (
            <CardGrid
              title={block.title}
              cards={
                block.cards?.map((card: any) => ({
                  title: card.title,
                  description: card.description,
                  image: card.image,
                  ctaText: card.link?.text,
                  ctaURL: card.link?.url,
                })) || []
              }
            />
          );

        case "textBlock":
          return (
            <TextBlockImageBg
              title={block.title}
              content={block.content}
              bgImage={block.bgImage}
            />
          );

        default:
          return null;
      }
    })
  }
</Layout>
