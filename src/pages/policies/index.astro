---
import CollectionItemList from "@/components/CollectionItemList.astro";
import PagesSection from "@/components/PagesSection.astro";
import Layout from "@/layouts/Layout.astro";
import PaginationNav from "@/components/PaginationNav.astro";
import { policyMapper } from "@/utilities/fetch";
import {
  getPaginatedCollectionData,
  createPagingStaticPath,
} from "@/utilities/fetch";

export const PAGE_SIZE = import.meta.env.PAGE_SIZE || 10;
const { page } = Astro.params;
const currentPage = parseInt(page) || 1;

const collectionName = "policies";

const { items, totalPages, hasPaginationNav } =
  await getPaginatedCollectionData(
    collectionName,
    currentPage,
    PAGE_SIZE,
    policyMapper,
  );

export const getStaticPaths = createPagingStaticPath(PAGE_SIZE, "policies");
export const prerender = import.meta.env.PREVIEW_MODE || false;
---

<Layout title="Policies" currentPage={currentPage} totalPages={totalPages}>
  <PagesSection
    heading="Policies"
    filteredPageConfig={{
      collectionName,
      pageSize: PAGE_SIZE,
      currentPage,
    }}
    color="gray-10"
  >
    <CollectionItemList items={items} />
    {
      hasPaginationNav && (
        <PaginationNav
          currentPage={currentPage}
          totalPages={totalPages}
          basePath="/policies/page"
        />
      )
    }
  </PagesSection>
</Layout>
