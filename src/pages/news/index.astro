---
import { getCollection } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import Link from "@/components/Link.astro";
import type { CollectionEntry } from "astro:content";
import payloadFetch from "@/utilities/payload-fetch";
import PagesSection from "@/components/PagesSection.astro";
import CollectionItemList from "@/components/CollectionItemList.astro";
import { newsMapper } from "@/utilities/newsMapper";


const collectionName = "news";
let news: CollectionEntry<typeof collectionName>["data"][];

if (!Astro.isPrerendered) {
  const response = await payloadFetch(`${collectionName}?draft=true`);
  const newsData = await response.json();
  news = newsData.docs;
  console.log(news);
} else {
  const newsCollection = await getCollection(collectionName);
  news = newsCollection.map((n) => n.data);
  console.log(news);
}

const items = news.map(newsMapper);
---

<Layout title="News">
  <PagesSection heading="News" color="gray-10">
    <CollectionItemList items={items}/>
  </PagesSection>
</Layout>
