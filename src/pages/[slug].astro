---
// src/pages/[slug].astro
import Layout from "@/layouts/Layout.astro";
import PagesSection from "@/components/PagesSection.astro";
import { fetchSlug, createStaticPathsForPagesSlug } from "@/utilities/fetch";
import RichText from "@/components/RichText.astro";
import Media from "@/components/Media.astro";

const { slug } = Astro.params;

let page;

if (!Astro.isPrerendered) {
  page = await fetchSlug("pages", slug);
  if (!page) return Astro.redirect("/404");
} else {
  page = await fetchSlug("pages", slug);
  if (!page) return Astro.redirect("/404");
}

export const getStaticPaths = createStaticPathsForPagesSlug();
---

<Layout title={page.title}>
  <PagesSection heading={page.title}>
    {page.image && <Media media={page.image} />}
    <RichText content={page.content} />
  </PagesSection>
</Layout>
