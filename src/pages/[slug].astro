---
// src/pages/[slug].astro
import Layout from "@/layouts/Layout.astro";
import PageWithSideNav from "@/components/PageWithSideNav.astro";
import { fetchSlug, createStaticPathsForPagesSlug } from "@/utilities/fetch";
import RichText from "@/components/RichText.astro";
import Media from "@/components/Media.astro";

const { slug } = Astro.params;

let page;

page = await fetchSlug("pages", slug);
if (!page) return Astro.redirect("/404");

export const getStaticPaths = createStaticPathsForPagesSlug();

export const prerender = import.meta.env.PREVIEW_MODE || false;
---

<Layout title={page.title} useBreadcrumbTitle={true}>
  <PageWithSideNav
    heading={page.title}
    showSideNav={true}
    currentPath={`/${page.slug}`}
    sideNavId={page.sideNavigation?.id}
  >
    {page.image && <Media media={page.image} />}
    <RichText content={page.content} />
  </PageWithSideNav>
</Layout>
